<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Preparation – Contents</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Contents</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resume.html"> 
<span class="menu-text">Resume</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../projects.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://www.linkedin.com/in/brendan-callender-4569a7218/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
    <a href="https://github.com/brendad8" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:bren.call8@gmail.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-envelope"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#base-dataset" id="toc-base-dataset" class="nav-link active" data-scroll-target="#base-dataset">Base Dataset</a></li>
  <li><a href="#previous-applications-dataset" id="toc-previous-applications-dataset" class="nav-link" data-scroll-target="#previous-applications-dataset">Previous Applications Dataset</a></li>
  <li><a href="#installments-payments-dataset" id="toc-installments-payments-dataset" class="nav-link" data-scroll-target="#installments-payments-dataset">Installments Payments Dataset</a></li>
  <li><a href="#credit-card-balance-dataset" id="toc-credit-card-balance-dataset" class="nav-link" data-scroll-target="#credit-card-balance-dataset">Credit Card Balance Dataset</a></li>
  <li><a href="#pos-cash-balance" id="toc-pos-cash-balance" class="nav-link" data-scroll-target="#pos-cash-balance">POS CASH Balance</a></li>
  <li><a href="#bureau-dataset" id="toc-bureau-dataset" class="nav-link" data-scroll-target="#bureau-dataset">Bureau Dataset</a></li>
  <li><a href="#join-datasets" id="toc-join-datasets" class="nav-link" data-scroll-target="#join-datasets">Join Datasets</a></li>
  <li><a href="#model-fitting-functions" id="toc-model-fitting-functions" class="nav-link" data-scroll-target="#model-fitting-functions">Model Fitting Functions</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-function" id="toc-logistic-regression-function" class="nav-link" data-scroll-target="#logistic-regression-function">Logistic Regression Function</a></li>
  </ul></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">Model Fitting</a>
  <ul class="collapse">
  <li><a href="#subset-data" id="toc-subset-data" class="nav-link" data-scroll-target="#subset-data">Subset Data</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic Regression</a>
  <ul class="collapse">
  <li><a href="#sub-1" id="toc-sub-1" class="nav-link" data-scroll-target="#sub-1">Sub 1</a></li>
  <li><a href="#sub-2" id="toc-sub-2" class="nav-link" data-scroll-target="#sub-2">Sub 2</a></li>
  <li><a href="#sub-3" id="toc-sub-3" class="nav-link" data-scroll-target="#sub-3">Sub 3</a></li>
  <li><a href="#sub-4" id="toc-sub-4" class="nav-link" data-scroll-target="#sub-4">Sub 4</a></li>
  <li><a href="#sub-5" id="toc-sub-5" class="nav-link" data-scroll-target="#sub-5">Sub 5</a></li>
  </ul></li>
  <li><a href="#svc" id="toc-svc" class="nav-link" data-scroll-target="#svc">SVC</a>
  <ul class="collapse">
  <li><a href="#sub-1-1" id="toc-sub-1-1" class="nav-link" data-scroll-target="#sub-1-1">Sub 1</a></li>
  <li><a href="#sub-2-1" id="toc-sub-2-1" class="nav-link" data-scroll-target="#sub-2-1">Sub 2</a></li>
  <li><a href="#sub-3-1" id="toc-sub-3-1" class="nav-link" data-scroll-target="#sub-3-1">Sub 3</a></li>
  <li><a href="#sub-4-1" id="toc-sub-4-1" class="nav-link" data-scroll-target="#sub-4-1">Sub 4</a></li>
  <li><a href="#sub-5-1" id="toc-sub-5-1" class="nav-link" data-scroll-target="#sub-5-1">Sub 5</a></li>
  </ul></li>
  <li><a href="#lda" id="toc-lda" class="nav-link" data-scroll-target="#lda">LDA</a>
  <ul class="collapse">
  <li><a href="#sub-1-2" id="toc-sub-1-2" class="nav-link" data-scroll-target="#sub-1-2">Sub 1</a></li>
  <li><a href="#sub-2-2" id="toc-sub-2-2" class="nav-link" data-scroll-target="#sub-2-2">Sub 2</a></li>
  <li><a href="#sub-3-2" id="toc-sub-3-2" class="nav-link" data-scroll-target="#sub-3-2">Sub 3</a></li>
  <li><a href="#sub-4-2" id="toc-sub-4-2" class="nav-link" data-scroll-target="#sub-4-2">Sub 4</a></li>
  <li><a href="#sub-5-2" id="toc-sub-5-2" class="nav-link" data-scroll-target="#sub-5-2">Sub 5</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model">Final Model</a>
  <ul class="collapse">
  <li><a href="#classification-model-linear-discriminant-analysis" id="toc-classification-model-linear-discriminant-analysis" class="nav-link" data-scroll-target="#classification-model-linear-discriminant-analysis">Classification Model: Linear Discriminant Analysis</a></li>
  <li><a href="#variable-set-set-5" id="toc-variable-set-set-5" class="nav-link" data-scroll-target="#variable-set-set-5">Variable Set: Set 5</a></li>
  <li><a href="#increased-subsample-size" id="toc-increased-subsample-size" class="nav-link" data-scroll-target="#increased-subsample-size">Increased Subsample Size</a></li>
  <li><a href="#threshold-tuning" id="toc-threshold-tuning" class="nav-link" data-scroll-target="#threshold-tuning">Threshold Tuning</a></li>
  </ul></li>
  <li><a href="#comparing-logreg-svm-and-lda" id="toc-comparing-logreg-svm-and-lda" class="nav-link" data-scroll-target="#comparing-logreg-svm-and-lda">Comparing LogReg, SVM, and LDA</a>
  <ul class="collapse">
  <li><a href="#probabilities-scores" id="toc-probabilities-scores" class="nav-link" data-scroll-target="#probabilities-scores">Probabilities / Scores</a></li>
  <li><a href="#predictions" id="toc-predictions" class="nav-link" data-scroll-target="#predictions">Predictions</a></li>
  <li><a href="#algorithm-comparison-conclusions" id="toc-algorithm-comparison-conclusions" class="nav-link" data-scroll-target="#algorithm-comparison-conclusions">Algorithm Comparison Conclusions</a></li>
  </ul></li>
  <li><a href="#fairness" id="toc-fairness" class="nav-link" data-scroll-target="#fairness">Fairness</a>
  <ul class="collapse">
  <li><a href="#fairness-metric-equalized-odds" id="toc-fairness-metric-equalized-odds" class="nav-link" data-scroll-target="#fairness-metric-equalized-odds">Fairness Metric = Equalized Odds</a></li>
  <li><a href="#testing-fairness-of-different-models" id="toc-testing-fairness-of-different-models" class="nav-link" data-scroll-target="#testing-fairness-of-different-models">Testing Fairness of Different Models</a>
  <ul class="collapse">
  <li><a href="#logreg-models" id="toc-logreg-models" class="nav-link" data-scroll-target="#logreg-models">LogReg Models</a></li>
  </ul></li>
  <li><a href="#fairness-for-our-best-predictive-model" id="toc-fairness-for-our-best-predictive-model" class="nav-link" data-scroll-target="#fairness-for-our-best-predictive-model">Fairness for our best predictive Model</a>
  <ul class="collapse">
  <li><a href="#fairness-vs-threshold" id="toc-fairness-vs-threshold" class="nav-link" data-scroll-target="#fairness-vs-threshold">Fairness vs Threshold</a></li>
  </ul></li>
  <li><a href="#final-fairness-analysis" id="toc-final-fairness-analysis" class="nav-link" data-scroll-target="#final-fairness-analysis">Final Fairness Analysis</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Preparation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-execution_count="482">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.discriminant_analysis <span class="im">import</span> LinearDiscriminantAnalysis</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder, StandardScaler, OneHotEncoder</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the data preparation portion of this notebook, we subset the base training data and merge it with additional varaibles from the other given datasets. The goal is to use the additional datasets to create more variables to better determine if an applicant will struggle to pay back a loan.</p>
<section id="base-dataset" class="level2">
<h2 class="anchored" data-anchor-id="base-dataset">Base Dataset</h2>
<div id="cell-5" class="cell" data-execution_count="530">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>loans <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/1ndeticw7z4n4vkwm21zc/application_train.csv?rlkey=fvx6hdqhg0fc1978szgz9x6e3&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-6" class="cell" data-execution_count="534">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>loans.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="534">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">TARGET</th>
<th data-quarto-table-cell-role="th">NAME_CONTRACT_TYPE</th>
<th data-quarto-table-cell-role="th">CODE_GENDER</th>
<th data-quarto-table-cell-role="th">FLAG_OWN_CAR</th>
<th data-quarto-table-cell-role="th">FLAG_OWN_REALTY</th>
<th data-quarto-table-cell-role="th">CNT_CHILDREN</th>
<th data-quarto-table-cell-role="th">AMT_INCOME_TOTAL</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT</th>
<th data-quarto-table-cell-role="th">AMT_ANNUITY</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">FLAG_DOCUMENT_18</th>
<th data-quarto-table-cell-role="th">FLAG_DOCUMENT_19</th>
<th data-quarto-table-cell-role="th">FLAG_DOCUMENT_20</th>
<th data-quarto-table-cell-role="th">FLAG_DOCUMENT_21</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_HOUR</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_DAY</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_WEEK</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_MON</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_QRT</th>
<th data-quarto-table-cell-role="th">AMT_REQ_CREDIT_BUREAU_YEAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100002</td>
<td>1</td>
<td>Cash loans</td>
<td>M</td>
<td>N</td>
<td>Y</td>
<td>0</td>
<td>202500.0</td>
<td>406597.5</td>
<td>24700.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100003</td>
<td>0</td>
<td>Cash loans</td>
<td>F</td>
<td>N</td>
<td>N</td>
<td>0</td>
<td>270000.0</td>
<td>1293502.5</td>
<td>35698.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100004</td>
<td>0</td>
<td>Revolving loans</td>
<td>M</td>
<td>Y</td>
<td>Y</td>
<td>0</td>
<td>67500.0</td>
<td>135000.0</td>
<td>6750.0</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100006</td>
<td>0</td>
<td>Cash loans</td>
<td>F</td>
<td>N</td>
<td>Y</td>
<td>0</td>
<td>135000.0</td>
<td>312682.5</td>
<td>29686.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100007</td>
<td>0</td>
<td>Cash loans</td>
<td>M</td>
<td>N</td>
<td>Y</td>
<td>0</td>
<td>121500.0</td>
<td>513000.0</td>
<td>21865.5</td>
<td>...</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 122 columns</p>
</div>
</div>
</div>
<p>Here is the subset of variables we plan on trying to use from the base training data. The variables contain info about many different aspects of an applicant.</p>
<div id="cell-8" class="cell" data-execution_count="535">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>usecols <span class="op">=</span> [<span class="st">'SK_ID_CURR'</span>, <span class="co"># ID</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'NAME_EDUCATION_TYPE'</span>, <span class="co"># Education</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">'CNT_FAM_MEMBERS'</span>, <span class="st">'DEF_30_CNT_SOCIAL_CIRCLE'</span>, <span class="co"># Family/Friends</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>           <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>, <span class="co"># Location</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>           <span class="st">'FLAG_OWN_CAR'</span>, <span class="st">'FLAG_OWN_REALTY'</span>, <span class="co"># Assets/Home</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>           <span class="st">'AMT_INCOME_TOTAL'</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="co"># Income/Job</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>           <span class="st">'AMT_CREDIT'</span>, <span class="co"># Loan Info</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>           <span class="st">'CODE_GENDER'</span>,<span class="st">'DAYS_BIRTH'</span>, <span class="co"># Fairness </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>           <span class="st">'TARGET'</span> <span class="co"># Response Variable</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>          ]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> loans[usecols].dropna().reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="base-data-cleaning" class="level4">
<h4 class="anchored" data-anchor-id="base-data-cleaning">Base Data Cleaning</h4>
<div id="cell-10" class="cell" data-execution_count="536">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_assets(res):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> res <span class="op">==</span> <span class="st">'Y'</span>:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-11" class="cell" data-execution_count="537">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>train[<span class="st">'FLAG_OWN_CAR'</span>] <span class="op">=</span> train[<span class="st">'FLAG_OWN_CAR'</span>].<span class="bu">apply</span>(map_assets)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>train[<span class="st">'FLAG_OWN_REALTY'</span>] <span class="op">=</span> train[<span class="st">'FLAG_OWN_REALTY'</span>].<span class="bu">apply</span>(map_assets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-12" class="cell" data-execution_count="538">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>train.loc[:,<span class="st">'REGION_RATING_CLIENT_W_CITY'</span>] <span class="op">=</span> train[<span class="st">'REGION_RATING_CLIENT_W_CITY'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="previous-applications-dataset" class="level2">
<h2 class="anchored" data-anchor-id="previous-applications-dataset">Previous Applications Dataset</h2>
<div id="cell-14" class="cell" data-execution_count="539">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>prev_app <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/la1qm68g32lil68hhqpuo/previous_application.csv?rlkey=s0qwfw8zbflsts0qlhx2va8lc&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are summarizing an applicants previous applications to gain more info about an applicants history. Some of the variables we are finding include how many prev applications has an applicant had, what was the average credit on those apps, how many were approved, canceled, refused, and unused.</p>
<div id="cell-16" class="cell" data-execution_count="540">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df_prev_app_res <span class="op">=</span> pd.concat([prev_app[<span class="st">'SK_ID_CURR'</span>], pd.get_dummies(prev_app[<span class="st">'NAME_CONTRACT_STATUS'</span>].<span class="bu">str</span>.upper(), dtype<span class="op">=</span><span class="bu">int</span>)], axis<span class="op">=</span><span class="dv">1</span>).groupby(<span class="st">'SK_ID_CURR'</span>).<span class="bu">sum</span>()</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>df_prev_app_res[<span class="st">'TOTAL_APPS'</span>] <span class="op">=</span> df_prev_app_res.<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_prev_app_res.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>df_temp <span class="op">=</span> prev_app.groupby(<span class="st">'SK_ID_CURR'</span>)[<span class="st">'AMT_CREDIT'</span>].mean().reset_index().rename(columns<span class="op">=</span>{<span class="st">'AMT_CREDIT'</span>:<span class="st">'AVG_PREV_AMT_CREDIT'</span>})</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>prev_app_sum <span class="op">=</span> df_prev_app_res.merge(df_temp, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-17" class="cell" data-execution_count="541">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>prev_app_sum.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="541">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">APPROVED</th>
<th data-quarto-table-cell-role="th">CANCELED</th>
<th data-quarto-table-cell-role="th">REFUSED</th>
<th data-quarto-table-cell-role="th">UNUSED OFFER</th>
<th data-quarto-table-cell-role="th">TOTAL_APPS</th>
<th data-quarto-table-cell-role="th">AVG_PREV_AMT_CREDIT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100001</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>23787.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100006</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>675000.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100007</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>232200.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100009</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>98239.5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100011</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="installments-payments-dataset" class="level2">
<h2 class="anchored" data-anchor-id="installments-payments-dataset">Installments Payments Dataset</h2>
<div id="cell-19" class="cell" data-execution_count="542">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>inst_pay <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/24dt10upopn3zbg0m7otk/installments_payments.csv?rlkey=l9u1qhoy904tglaq8nng99adr&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are trying to gain insight into an applicants ability to pay different installments of previous credit. Some of the variables we calculate are how many late, ontime, no payment, insufficient, and full payments an applicant has.</p>
<div id="cell-21" class="cell" data-execution_count="543">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_LATE_PAY'</span>] <span class="op">=</span> (inst_pay[<span class="st">'DAYS_ENTRY_PAYMENT'</span>] <span class="op">&gt;</span> inst_pay[<span class="st">'DAYS_INSTALMENT'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_ONTIME_PAY'</span>] <span class="op">=</span> (inst_pay[<span class="st">'DAYS_ENTRY_PAYMENT'</span>] <span class="op">&lt;=</span> inst_pay[<span class="st">'DAYS_INSTALMENT'</span>]).astype(<span class="bu">int</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_NO_PAYMENT'</span>] <span class="op">=</span> (inst_pay[<span class="st">'AMT_PAYMENT'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_PAYMENTS'</span>] <span class="op">=</span> pd.Series([<span class="dv">1</span>]<span class="op">*</span>inst_pay.shape[<span class="dv">0</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_INSUF_PAYMENT'</span>] <span class="op">=</span> ((inst_pay[<span class="st">'AMT_PAYMENT'</span>] <span class="op">&lt;</span> (<span class="dv">3</span><span class="op">/</span><span class="dv">4</span>)<span class="op">*</span>inst_pay[<span class="st">'AMT_INSTALMENT'</span>])).astype(<span class="bu">int</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>inst_pay[<span class="st">'N_FULL_PAYMENT'</span>] <span class="op">=</span> ((inst_pay[<span class="st">'AMT_PAYMENT'</span>] <span class="op">&gt;=</span> inst_pay[<span class="st">'AMT_INSTALMENT'</span>])).astype(<span class="bu">int</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>inst_pay_vars <span class="op">=</span> inst_pay.groupby([<span class="st">'SK_ID_CURR'</span>])[[<span class="st">'N_LATE_PAY'</span>, <span class="st">'N_ONTIME_PAY'</span>, <span class="st">'N_NO_PAYMENT'</span>, <span class="st">'N_PAYMENTS'</span>, <span class="st">'N_INSUF_PAYMENT'</span>, <span class="st">'N_FULL_PAYMENT'</span>]].<span class="bu">sum</span>().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-22" class="cell" data-execution_count="544">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>inst_pay_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="544">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">N_LATE_PAY</th>
<th data-quarto-table-cell-role="th">N_ONTIME_PAY</th>
<th data-quarto-table-cell-role="th">N_NO_PAYMENT</th>
<th data-quarto-table-cell-role="th">N_PAYMENTS</th>
<th data-quarto-table-cell-role="th">N_INSUF_PAYMENT</th>
<th data-quarto-table-cell-role="th">N_FULL_PAYMENT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100001</td>
<td>1</td>
<td>6</td>
<td>0</td>
<td>7</td>
<td>0</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100002</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>19</td>
<td>0</td>
<td>19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100003</td>
<td>0</td>
<td>25</td>
<td>0</td>
<td>25</td>
<td>0</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100004</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100005</td>
<td>1</td>
<td>8</td>
<td>0</td>
<td>9</td>
<td>0</td>
<td>9</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="credit-card-balance-dataset" class="level2">
<h2 class="anchored" data-anchor-id="credit-card-balance-dataset">Credit Card Balance Dataset</h2>
<div id="cell-24" class="cell" data-execution_count="545">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cred_card <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/360n45paoyg7jmcvtn0zd/credit_card_balance.csv?rlkey=gpekmyu1sy9na303yifydmn9b&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are doing the same as the installments payments dataset but for credit card loan payments. We calculate the number of days past due patments, ontime payments and total payments an applicant has</p>
<div id="cell-26" class="cell" data-execution_count="546">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>cred_card[<span class="st">'N_DPD_CC'</span>] <span class="op">=</span> (cred_card[<span class="st">'SK_DPD_DEF'</span>] <span class="op">&gt;</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>cred_card[<span class="st">'N_ONTIME_CC'</span>] <span class="op">=</span> (cred_card[<span class="st">'SK_DPD_DEF'</span>] <span class="op">==</span> <span class="dv">0</span>).astype(<span class="bu">int</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>cred_card[<span class="st">'N_PAYMENTS_CC'</span>] <span class="op">=</span> pd.Series([<span class="dv">1</span>]<span class="op">*</span>cred_card.shape[<span class="dv">0</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>cred_card_vars <span class="op">=</span> pd.DataFrame(cred_card.groupby(<span class="st">'SK_ID_CURR'</span>)[[<span class="st">'N_DPD_CC'</span>, <span class="st">'N_ONTIME_CC'</span>, <span class="st">'N_PAYMENTS_CC'</span>]].<span class="bu">sum</span>()).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-27" class="cell" data-execution_count="547">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cred_card_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="547">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">N_DPD_CC</th>
<th data-quarto-table-cell-role="th">N_ONTIME_CC</th>
<th data-quarto-table-cell-role="th">N_PAYMENTS_CC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100006</td>
<td>0</td>
<td>6</td>
<td>6</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100011</td>
<td>0</td>
<td>74</td>
<td>74</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100013</td>
<td>1</td>
<td>95</td>
<td>96</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100021</td>
<td>0</td>
<td>17</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100023</td>
<td>0</td>
<td>8</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="pos-cash-balance" class="level2">
<h2 class="anchored" data-anchor-id="pos-cash-balance">POS CASH Balance</h2>
<div id="cell-29" class="cell" data-execution_count="548">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pos_cash <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/ya687sh4v0s2jkavtwle1/POS_CASH_balance.csv?rlkey=3oypt1u95yj908y7kja3ourkm&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-30" class="cell" data-execution_count="549">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>pos_cash[<span class="st">'N_COMPLETED_CONTRACTS'</span>] <span class="op">=</span> (pos_cash[pos_cash[<span class="st">'CNT_INSTALMENT'</span>] <span class="op">&gt;=</span> <span class="dv">12</span>][<span class="st">'NAME_CONTRACT_STATUS'</span>] <span class="op">==</span> <span class="st">'Completed'</span>).astype(<span class="bu">int</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>pos_cash_vars <span class="op">=</span> pos_cash.groupby(<span class="st">'SK_ID_CURR'</span>)[<span class="st">'N_COMPLETED_CONTRACTS'</span>].<span class="bu">sum</span>().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-31" class="cell" data-execution_count="550">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pos_cash_vars.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="550">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">N_COMPLETED_CONTRACTS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100001</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100002</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100003</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100004</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100005</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="bureau-dataset" class="level2">
<h2 class="anchored" data-anchor-id="bureau-dataset">Bureau Dataset</h2>
<div id="cell-33" class="cell" data-execution_count="551">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>bureau <span class="op">=</span> pd.read_csv(<span class="st">'https://www.dropbox.com/scl/fi/b5y4piwjimd2qlsthvkud/bureau.csv?rlkey=yr1an067kgnz1q7k8dll46f9q&amp;dl=1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-34" class="cell" data-execution_count="552">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> map_credit_type(s):</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> s.lower() <span class="kw">in</span> (<span class="st">'real estate loan'</span>, <span class="st">'mortgage'</span>):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'M'</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'O'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-35" class="cell" data-execution_count="553">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>bureau_2 <span class="op">=</span> bureau.loc[:, [<span class="st">'SK_ID_CURR'</span>, <span class="st">'CREDIT_DAY_OVERDUE'</span>, <span class="st">'AMT_CREDIT_SUM_OVERDUE'</span>, <span class="st">'CREDIT_TYPE'</span>, <span class="st">'CREDIT_ACTIVE'</span>]].copy()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bureau_2[<span class="st">'CREDIT_TYPE_GEN'</span>] <span class="op">=</span> bureau_2[<span class="st">'CREDIT_TYPE'</span>].astype(<span class="bu">str</span>).<span class="bu">apply</span>(map_credit_type)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>bureau_2 <span class="op">=</span> bureau_2[bureau_2[<span class="st">'CREDIT_ACTIVE'</span>] <span class="op">==</span> <span class="st">"Active"</span>].drop([<span class="st">'CREDIT_TYPE'</span>, <span class="st">'CREDIT_ACTIVE'</span>], axis<span class="op">=</span><span class="dv">1</span>).groupby([<span class="st">'SK_ID_CURR'</span>, <span class="st">'CREDIT_TYPE_GEN'</span>]).<span class="bu">sum</span>().unstack().fillna(<span class="dv">0</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>bureau_2.columns <span class="op">=</span> [<span class="st">'CREDIT_DAY_OVERDUE_MORTGAGE'</span>, <span class="st">'CREDIT_DAY_OVERDUE_OTHER'</span>, <span class="st">'AMT_CREDIT_SUM_OVERDUE_MORTGAGE'</span>, <span class="st">'AMT_CREDIT_SUM_OVERDUE_OTHER'</span>]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>bureau_2.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-36" class="cell" data-execution_count="554">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bureau_2.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="554">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">CREDIT_DAY_OVERDUE_MORTGAGE</th>
<th data-quarto-table-cell-role="th">CREDIT_DAY_OVERDUE_OTHER</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT_SUM_OVERDUE_MORTGAGE</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT_SUM_OVERDUE_OTHER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100001</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100016</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100019</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100020</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100026</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="join-datasets" class="level2">
<h2 class="anchored" data-anchor-id="join-datasets">Join Datasets</h2>
<p>When joining the datasets, we made sure to use a left join so we do not lose observations that did not have data in the extra datasets. Therefore, if an applicant is not in these extra data tables, we will not be able to incorporate the additional information when predicting whether they will have difficulty paying back a loan.</p>
<div id="cell-39" class="cell" data-execution_count="555">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>train_full <span class="op">=</span> train.merge(prev_app_sum, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>, how<span class="op">=</span><span class="st">'left'</span>).merge(inst_pay_vars, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>, how<span class="op">=</span><span class="st">'left'</span>).merge(cred_card_vars, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>, how<span class="op">=</span><span class="st">'left'</span>).merge(pos_cash_vars, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>, how<span class="op">=</span><span class="st">'left'</span>).merge(bureau_2, on<span class="op">=</span><span class="st">'SK_ID_CURR'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-40" class="cell" data-execution_count="556">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>train_full <span class="op">=</span> train_full.fillna(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-41" class="cell" data-execution_count="557">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>train_full.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="557">
<pre><code>(306488, 33)</code></pre>
</div>
</div>
<div id="cell-42" class="cell" data-execution_count="558">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>train_full.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="558">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">SK_ID_CURR</th>
<th data-quarto-table-cell-role="th">NAME_EDUCATION_TYPE</th>
<th data-quarto-table-cell-role="th">CNT_FAM_MEMBERS</th>
<th data-quarto-table-cell-role="th">DEF_30_CNT_SOCIAL_CIRCLE</th>
<th data-quarto-table-cell-role="th">REGION_RATING_CLIENT_W_CITY</th>
<th data-quarto-table-cell-role="th">FLAG_OWN_CAR</th>
<th data-quarto-table-cell-role="th">FLAG_OWN_REALTY</th>
<th data-quarto-table-cell-role="th">AMT_INCOME_TOTAL</th>
<th data-quarto-table-cell-role="th">NAME_INCOME_TYPE</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">N_INSUF_PAYMENT</th>
<th data-quarto-table-cell-role="th">N_FULL_PAYMENT</th>
<th data-quarto-table-cell-role="th">N_DPD_CC</th>
<th data-quarto-table-cell-role="th">N_ONTIME_CC</th>
<th data-quarto-table-cell-role="th">N_PAYMENTS_CC</th>
<th data-quarto-table-cell-role="th">N_COMPLETED_CONTRACTS</th>
<th data-quarto-table-cell-role="th">CREDIT_DAY_OVERDUE_MORTGAGE</th>
<th data-quarto-table-cell-role="th">CREDIT_DAY_OVERDUE_OTHER</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT_SUM_OVERDUE_MORTGAGE</th>
<th data-quarto-table-cell-role="th">AMT_CREDIT_SUM_OVERDUE_OTHER</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>100002</td>
<td>Secondary / secondary special</td>
<td>1.0</td>
<td>2.0</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>202500.0</td>
<td>Working</td>
<td>406597.5</td>
<td>...</td>
<td>0.0</td>
<td>19.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>100003</td>
<td>Higher education</td>
<td>2.0</td>
<td>0.0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>270000.0</td>
<td>State servant</td>
<td>1293502.5</td>
<td>...</td>
<td>0.0</td>
<td>25.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>100004</td>
<td>Secondary / secondary special</td>
<td>1.0</td>
<td>0.0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>67500.0</td>
<td>Working</td>
<td>135000.0</td>
<td>...</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>100006</td>
<td>Secondary / secondary special</td>
<td>2.0</td>
<td>0.0</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>135000.0</td>
<td>Working</td>
<td>312682.5</td>
<td>...</td>
<td>0.0</td>
<td>16.0</td>
<td>0.0</td>
<td>6.0</td>
<td>6.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>100007</td>
<td>Secondary / secondary special</td>
<td>1.0</td>
<td>0.0</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>121500.0</td>
<td>Working</td>
<td>513000.0</td>
<td>...</td>
<td>3.0</td>
<td>60.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>3.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>5 rows × 33 columns</p>
</div>
</div>
</div>
</section>
<section id="model-fitting-functions" class="level1">
<h1>Model Fitting Functions</h1>
<p>This section includes all the function used in testing/fitting the three different classification methods.</p>
<p>Cross val contains many different methods for cross validation. The first method is regular k-fold CV. The second, stratified_target, allows us to mantain equal distribtuions of the target variable across testing and training splits. Additinally, “stratified” allows us to mantain an equal distribution of any target category across training and testing splits. This could potentially be used to stratify on age if we were to bin age into different categories.</p>
<div id="cell-46" class="cell" data-execution_count="199">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> crossVal(model, X, Y, eta, numSplits, splitType, targetCats <span class="op">=</span> <span class="va">None</span>, cutoff <span class="op">=</span> <span class="fl">0.5</span>, prot_group_data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    df_res <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'metric'</span>, <span class="st">'val'</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    splits <span class="op">=</span> []</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> splitType <span class="op">==</span> <span class="st">"k-fold"</span>:</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        indicies <span class="op">=</span> random.sample(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X))), <span class="bu">len</span>(X))</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> numSplits:</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            testIndicies <span class="op">=</span> <span class="bu">set</span>(indicies[<span class="bu">int</span>((i<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(X)) : <span class="bu">int</span>((((i<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(X)))])</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>            trainIndicies <span class="op">=</span> <span class="bu">set</span>(indicies) <span class="op">-</span> testIndicies</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>            splits.append((trainIndicies, testIndicies))</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> splitType <span class="op">==</span> <span class="st">"stratified_target"</span>:</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        positiveSer <span class="op">=</span> Y[Y <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        negativeSer <span class="op">=</span> Y[Y <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        positiveIndicies <span class="op">=</span> random.sample(<span class="bu">list</span>(positiveSer.index), <span class="bu">len</span>(positiveSer))</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        negativeIndicies <span class="op">=</span> random.sample(<span class="bu">list</span>(negativeSer.index), <span class="bu">len</span>(negativeSer))</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>        allIndicies <span class="op">=</span> <span class="bu">list</span>(positiveIndicies.copy())</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>        allIndicies.extend(<span class="bu">list</span>(negativeIndicies))</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> numSplits:</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>            positiveTest <span class="op">=</span> <span class="bu">list</span>(positiveIndicies[<span class="bu">int</span>((i<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(positiveIndicies)) : <span class="bu">int</span>((((i<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(positiveIndicies)))])</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>            negativeTest <span class="op">=</span> <span class="bu">list</span>(negativeIndicies[<span class="bu">int</span>((i<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(negativeIndicies)) : <span class="bu">int</span>((((i<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(negativeIndicies)))])</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>            positiveTest.extend(negativeTest)</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>            testIndicies <span class="op">=</span> <span class="bu">set</span>(positiveTest)</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>            trainIndicies <span class="op">=</span> <span class="bu">set</span>(allIndicies) <span class="op">-</span> testIndicies</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>            splits.append((trainIndicies, testIndicies))</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> splitType <span class="op">==</span> <span class="st">"resample"</span>:</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>        indicies <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X)))</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> numSplits:</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>            testIndicies <span class="op">=</span> <span class="bu">set</span>(<span class="bu">list</span>(random.sample(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X))), <span class="bu">int</span>(<span class="bu">len</span>(X)<span class="op">/</span><span class="dv">4</span>))))</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>            trainIndicies <span class="op">=</span> <span class="bu">set</span>(indicies) <span class="op">-</span> testIndicies</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>            splits.append((trainIndicies, testIndicies))</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> splitType <span class="op">==</span> <span class="st">"stratified"</span>:</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>        indexGroups <span class="op">=</span> []</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>        testSets <span class="op">=</span> []</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>        indicies <span class="op">=</span> <span class="bu">list</span>(X.groupby(targetCats).size().index)</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> indicies:</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>            indexGroups.append(<span class="bu">list</span>(X[(X[targetCats] <span class="op">==</span> index).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>)].index))</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group <span class="kw">in</span> indexGroups:</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>            testSets.append(random.sample(group, <span class="bu">len</span>(group)))</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>        allIndicies <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X)))</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>        i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> i <span class="op">&lt;</span> numSplits:</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>            testIndicies <span class="op">=</span> []</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> testSet <span class="kw">in</span> testSets:</span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>                testIndicies.extend(<span class="bu">list</span>(testSet[<span class="bu">int</span>((i<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(testSet)) : <span class="bu">int</span>((((i<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(testSet)))]))</span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>            trainIndicies <span class="op">=</span> <span class="bu">set</span>(allIndicies) <span class="op">-</span> <span class="bu">set</span>(testIndicies)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>            splits.append((trainIndicies, testIndicies))</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>            i <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> splitType <span class="op">==</span> <span class="st">"targetOnly"</span>:</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a>        indexGroups <span class="op">=</span> []</span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>        testSets <span class="op">=</span> []</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>        indicies <span class="op">=</span> <span class="bu">list</span>(X.groupby(targetCats).size().index)</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> indicies:</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>            indexGroups.append(<span class="bu">list</span>(X[(X[targetCats] <span class="op">==</span> index).<span class="bu">all</span>(axis<span class="op">=</span><span class="dv">1</span>)].index))</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> group <span class="kw">in</span> indexGroups:</span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a>            testSets.append(random.sample(group, <span class="bu">len</span>(group)))</span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>        allIndicies <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X)))</span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> testSet <span class="kw">in</span> testSets:</span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>            testIndicies <span class="op">=</span> <span class="bu">list</span>(testSet[<span class="dv">0</span> : <span class="bu">int</span>(((<span class="fl">.2</span>)<span class="op">*</span><span class="bu">len</span>(testSet)))])</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>            trainIndicies <span class="op">=</span> <span class="bu">set</span>(allIndicies) <span class="op">-</span> <span class="bu">set</span>(testIndicies)</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>            splits.append((trainIndicies, testIndicies))</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> train, test <span class="kw">in</span> splits:</span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a>        train_x <span class="op">=</span> X.iloc[<span class="bu">list</span>(train)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a>        train_y <span class="op">=</span> Y.iloc[<span class="bu">list</span>(train)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a>        test_x <span class="op">=</span> X.iloc[<span class="bu">list</span>(test)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a>        test_y <span class="op">=</span> Y.iloc[<span class="bu">list</span>(test)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> prot_group_data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a>            prot_group_data_test <span class="op">=</span> prot_group_data[<span class="bu">list</span>(test)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a>            prot_group_data_test <span class="op">=</span> <span class="va">None</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a>        df_res <span class="op">=</span> pd.concat([df_res, fit_model(train_x, train_y, test_x, test_y, eta, model, cutoff<span class="op">=</span>cutoff, prot_group_data<span class="op">=</span>prot_group_data_test)], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_res.groupby(<span class="st">'metric'</span>).mean().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-47" class="cell" data-execution_count="200">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> roc_auc(Y, p):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    spec <span class="op">=</span> []</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    sens <span class="op">=</span> []</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> pd.Series(p).sort_values()</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, prob <span class="kw">in</span> <span class="bu">enumerate</span>(p):</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (i <span class="op">!=</span> <span class="dv">0</span>) <span class="kw">and</span> (i <span class="op">!=</span> <span class="bu">len</span>(p)<span class="op">-</span><span class="dv">1</span>):</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>            y_hat <span class="op">=</span> (p <span class="op">&gt;</span> prob).astype(<span class="bu">int</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>            conf_matrix <span class="op">=</span> pd.crosstab(Y, y_hat)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>            tp <span class="op">=</span> conf_matrix[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>            tn <span class="op">=</span> conf_matrix[<span class="dv">0</span>][<span class="dv">0</span>]</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>            fp <span class="op">=</span> conf_matrix[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>            fn <span class="op">=</span> conf_matrix[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>            spec <span class="op">+=</span> [tn <span class="op">/</span> (tn <span class="op">+</span> fp)]</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>            sens <span class="op">+=</span> [tp <span class="op">/</span> (tp <span class="op">+</span> fn)]</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.trapz(sens, spec)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-48" class="cell" data-execution_count="242">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_model(train_x, train_y, test_x, test_y, eta, model, lam <span class="op">=</span> <span class="dv">0</span>, cutoff <span class="op">=</span> <span class="fl">.5</span>, prot_group_data<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model <span class="op">==</span> <span class="st">"logReg"</span>:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>        betas <span class="op">=</span> fit_logreg(train_x, train_y, eta, lam)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> test_x.to_numpy() <span class="op">@</span> betas</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>z))</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> (p <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model <span class="op">==</span> <span class="st">"SVM"</span>:</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> SVC(probability<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        model.fit(train_x, train_y)</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> model.predict_proba(test_x)[:,<span class="dv">1</span>]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> (p <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> model <span class="op">==</span> <span class="st">"LDA"</span>:</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> LinearDiscriminantAnalysis()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        model.fit(train_x, train_y)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> model.predict_proba(test_x)[:,<span class="dv">1</span>]</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        preds <span class="op">=</span> (p <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    confusionMatrix <span class="op">=</span> pd.crosstab(test_y, preds)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    df_res <span class="op">=</span> pd.DataFrame(columns<span class="op">=</span>[<span class="st">'metric'</span>, <span class="st">'val'</span>])</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>        tp <span class="op">=</span> confusionMatrix.at[<span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        tp <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>        tn <span class="op">=</span> confusionMatrix.at[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>        tn <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> confusionMatrix.at[<span class="dv">0</span>,<span class="dv">1</span>]</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        fn <span class="op">=</span> confusionMatrix.at[<span class="dv">1</span>,<span class="dv">0</span>]</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>        fn <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>        fdr <span class="op">=</span> (fp <span class="op">/</span> (fp <span class="op">+</span> tp))</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>        fdr <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>        fnr <span class="op">=</span> (fn <span class="op">/</span> (fn <span class="op">+</span> tp))</span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>        fnr <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>        prec <span class="op">=</span> (tp <span class="op">/</span> (tp <span class="op">+</span> fp))</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>        prec <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a>        rec <span class="op">=</span> (tp <span class="op">/</span> (tp <span class="op">+</span> fn))</span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>        rec <span class="op">=</span> <span class="va">None</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prot_group_data <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>        protectedYesIndex <span class="op">=</span> <span class="bu">list</span>(test_y[(test_y <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (prot_group_data <span class="op">==</span> <span class="dv">1</span>)].index)</span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>        unprotectedYesIndex <span class="op">=</span> <span class="bu">list</span>(test_y[(test_y <span class="op">==</span> <span class="dv">1</span>) <span class="op">&amp;</span> (prot_group_data <span class="op">!=</span> <span class="dv">1</span>)].index)</span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>        protectedNoIndex <span class="op">=</span> <span class="bu">list</span>(test_y[(test_y <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (prot_group_data <span class="op">==</span> <span class="dv">1</span>)].index)</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>        unprotectedNoIndex <span class="op">=</span> <span class="bu">list</span>(test_y[(test_y <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (prot_group_data <span class="op">!=</span> <span class="dv">1</span>)].index)</span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>        probYesProtected <span class="op">=</span> preds[protectedYesIndex].mean()</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>        probYesUnprotected <span class="op">=</span> preds[unprotectedYesIndex].mean()</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>        tpr <span class="op">=</span> probYesProtected<span class="op">/</span>probYesUnprotected</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>        probNoProtected <span class="op">=</span> preds[protectedNoIndex].mean()</span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>        probNoUnprotected <span class="op">=</span> preds[unprotectedNoIndex].mean()</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a>        fpr <span class="op">=</span> probNoUnprotected<span class="op">/</span>probNoProtected</span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> [(<span class="dv">2</span><span class="op">*</span>tp)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>tp <span class="op">+</span> fp <span class="op">+</span> fn), (tp<span class="op">+</span>tn)<span class="op">/</span>(tp<span class="op">+</span>tn<span class="op">+</span>fp<span class="op">+</span>fn), roc_auc(test_y, p), fdr, fnr, tpr, fpr, prec, rec]</span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>        df_res[<span class="st">'metric'</span>] <span class="op">=</span> pd.Series([<span class="st">'F1'</span>, <span class="st">'Accuracy'</span>, <span class="st">'ROC-AUC'</span>, <span class="st">'False Discovery Rate'</span>, <span class="st">'False Negative Rate'</span>, <span class="st">'True Pos Rate'</span>, <span class="st">'False Pos Rate'</span>, <span class="st">'Precision'</span>, <span class="st">'Recall'</span>])</span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>        df_res[<span class="st">'val'</span>] <span class="op">=</span> pd.Series(res)</span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>        res <span class="op">=</span> [(<span class="dv">2</span><span class="op">*</span>tp)<span class="op">/</span>(<span class="dv">2</span><span class="op">*</span>tp <span class="op">+</span> fp <span class="op">+</span> fn), (tp<span class="op">+</span>tn)<span class="op">/</span>(tp<span class="op">+</span>tn<span class="op">+</span>fp<span class="op">+</span>fn), roc_auc(test_y, p), fdr, fnr, prec, rec]</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>        df_res[<span class="st">'metric'</span>] <span class="op">=</span> pd.Series([<span class="st">'F1'</span>, <span class="st">'Accuracy'</span>, <span class="st">'ROC-AUC'</span>, <span class="st">'False Discovery Rate'</span>, <span class="st">'False Negative Rate'</span>, <span class="st">'Precision'</span>, <span class="st">'Recall'</span>])</span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>        df_res[<span class="st">'val'</span>] <span class="op">=</span> pd.Series(res)</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="logistic-regression-function" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression-function">Logistic Regression Function</h2>
<div id="cell-50" class="cell" data-execution_count="202">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> gradient(betas, X, c, p, lam):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    dl_dbeta <span class="op">=</span> [<span class="dv">0</span>] <span class="op">*</span> <span class="bu">len</span>(betas)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(betas)):</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> X.iloc[:,i]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        dl_dbeta[i] <span class="op">=</span> ((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>c<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>p)<span class="op">*</span>x).<span class="bu">sum</span>() <span class="op">+</span> ((<span class="dv">1</span><span class="op">-</span>c)<span class="op">*</span>p<span class="op">*</span>x).<span class="bu">sum</span>() <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>lam<span class="op">*</span>betas[i]</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.Series(dl_dbeta)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_betas(betas, gradient, eta):</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> betas <span class="op">-</span> eta<span class="op">*</span>gradient</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_stop_cond1(gradient):</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">max</span>(gradient) <span class="op">&lt;=</span> <span class="fl">0.0001</span>:</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> check_stop_cond2(<span class="bu">iter</span>):</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">iter</span> <span class="op">==</span> <span class="dv">2000</span>:</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fit_logreg(X, Y, eta, lam):</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">iter</span> <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    stop <span class="op">=</span> <span class="va">False</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    betas <span class="op">=</span> pd.Series([<span class="dv">0</span>]<span class="op">*</span>X.shape[<span class="dv">1</span>])</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="kw">not</span> stop:</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> (X.to_numpy() <span class="op">@</span> betas.to_numpy())</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>        p <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>z))</span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>        dl_dbeta <span class="op">=</span> gradient(betas, X, Y, p, lam)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        betas <span class="op">=</span> update_betas(betas, dl_dbeta, eta)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a>        <span class="bu">iter</span> <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>        eta <span class="op">=</span> eta<span class="op">*</span><span class="fl">.99</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>        stop <span class="op">=</span> check_stop_cond1(dl_dbeta)</span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>        stop <span class="op">=</span> check_stop_cond2(<span class="bu">iter</span>)</span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> betas.to_numpy()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-fitting" class="level1">
<h1>Model Fitting</h1>
<p>In this section, we will test each type of classification model for different subsets of variables. The three classification models include Linear Regression, Support Vector Classfifier, and Linear Discriminant Analysis.</p>
<div id="cell-53" class="cell" data-execution_count="450">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>train_full[<span class="st">'TARGET'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="450">
<pre><code>TARGET
0    0.919119
1    0.080881
Name: proportion, dtype: float64</code></pre>
</div>
</div>
<section id="subset-data" class="level3">
<h3 class="anchored" data-anchor-id="subset-data">Subset Data</h3>
<p>We wanted to create a smaller subset of the data to test models on so code could be run more efficiently over different sets of variables. For the smaller subset, we took a 80/20 split of the target variable. The full data contains a rough 92/8 split of the response variable so our subset is more dense with respect to TARGET==1.</p>
<p>Additionally we will be stratifying the data for cross validaiton with respect to the target to ensure the distribution of observations with TARGET==1 is equally spread across the folds. This is especially important given the imbalance between TARGET==0/1 in the data.</p>
<div id="cell-57" class="cell" data-execution_count="274">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>train_sub_pos <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">2000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>train_sub_neg <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">0</span>].sample(<span class="dv">8000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-58" class="cell" data-execution_count="275">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>train_sub <span class="op">=</span> pd.concat([train_sub_pos, train_sub_neg], axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<section id="sub-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-1">Sub 1</h3>
<div id="cell-61" class="cell" data-execution_count="236">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ct1 <span class="op">=</span> make_column_transformer(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>, <span class="st">'FLAG_OWN_REALTY'</span>]),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'AMT_INCOME_TOTAL'</span>, <span class="st">'AMT_CREDIT'</span>, <span class="st">'APPROVED'</span>, <span class="st">'REFUSED'</span>, <span class="st">'N_LATE_PAY'</span>, <span class="st">'N_FULL_PAYMENT'</span>]),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>]),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct1.fit_transform(train_sub))</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell" data-execution_count="237">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="237">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.629039</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.388863</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.502393</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.679189</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.497607</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.619514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.320811</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-2">Sub 2</h3>
<div id="cell-64" class="cell" data-execution_count="238">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ct2 <span class="op">=</span> make_column_transformer(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>, <span class="st">'FLAG_OWN_REALTY'</span>]),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'AMT_INCOME_TOTAL'</span>, <span class="st">'AMT_CREDIT'</span>, <span class="st">'APPROVED'</span>, <span class="st">'REFUSED'</span>, <span class="st">'N_LATE_PAY'</span>, <span class="st">'N_FULL_PAYMENT'</span>, <span class="st">'N_COMPLETED_CONTRACTS'</span>, <span class="st">'N_ONTIME_CC'</span>, <span class="st">'N_DPD_CC'</span>]),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>, <span class="st">'CODE_GENDER'</span>]),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct2.fit_transform(train_sub))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-65" class="cell" data-execution_count="239">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="239">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.631142</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.023285</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.221916</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.988154</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.778084</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.643126</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.011846</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-3" class="level3">
<h3 class="anchored" data-anchor-id="sub-3">Sub 3</h3>
<div id="cell-67" class="cell" data-execution_count="243">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>ct3 <span class="op">=</span> make_column_transformer(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>, <span class="st">'FLAG_OWN_REALTY'</span>]),</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'AMT_INCOME_TOTAL'</span>, <span class="st">'AMT_CREDIT'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>, <span class="st">'N_LATE_PAY'</span>, <span class="st">'N_COMPLETED_CONTRACTS'</span>]),</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>]),</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct3.fit_transform(train_sub))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-68" class="cell" data-execution_count="244">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="244">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.631680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>1.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.610827</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-4" class="level3">
<h3 class="anchored" data-anchor-id="sub-4">Sub 4</h3>
<div id="cell-70" class="cell" data-execution_count="245">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>ct4 <span class="op">=</span> make_column_transformer(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>, <span class="st">'FLAG_OWN_REALTY'</span>]),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'AMT_INCOME_TOTAL'</span>, <span class="st">'AMT_CREDIT'</span>, <span class="st">'N_LATE_PAY'</span>, <span class="st">'N_COMPLETED_CONTRACTS'</span>, <span class="st">'CREDIT_DAY_OVERDUE_MORTGAGE'</span>, <span class="st">'CREDIT_DAY_OVERDUE_OTHER'</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">'AMT_CREDIT_SUM_OVERDUE_MORTGAGE'</span>, <span class="st">'AMT_CREDIT_SUM_OVERDUE_OTHER'</span>]),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>]),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct4.fit_transform(train_sub))</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-71" class="cell" data-execution_count="246">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="246">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.632527</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.001735</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.250000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.999131</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.750000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.610655</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.000869</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-5" class="level3">
<h3 class="anchored" data-anchor-id="sub-5">Sub 5</h3>
<div id="cell-73" class="cell" data-execution_count="276">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ct5 <span class="op">=</span> make_column_transformer(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>]),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'REFUSED'</span>, <span class="st">'N_ONTIME_PAY'</span>, <span class="st">'N_PAYMENTS'</span>, <span class="st">'DEF_30_CNT_SOCIAL_CIRCLE'</span>]),</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>]),</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub))</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-74" class="cell" data-execution_count="248">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="248">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.631124</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.430720</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.498095</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.622407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.501905</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.631738</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.377593</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="svc" class="level2">
<h2 class="anchored" data-anchor-id="svc">SVC</h2>
<section id="sub-1-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-1-1">Sub 1</h3>
<div id="cell-77" class="cell" data-execution_count="277">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct1.fit_transform(train_sub))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-78" class="cell" data-execution_count="278">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'SVM'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="278">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.627455</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.036731</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.579197</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.980714</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.420803</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.551428</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.019286</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-2-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-2-1">Sub 2</h3>
<div id="cell-80" class="cell" data-execution_count="279">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct2.fit_transform(train_sub))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-81" class="cell" data-execution_count="280">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'SVM'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="280">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.625900</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.051749</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.594659</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.972262</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.405341</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.546531</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.027738</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-3-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-3-1">Sub 3</h3>
<div id="cell-83" class="cell" data-execution_count="281">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct3.fit_transform(train_sub))</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-84" class="cell" data-execution_count="282">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'SVM'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="282">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.628688</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.032583</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.538690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.983030</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.461310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.544372</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.016970</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-4-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-4-1">Sub 4</h3>
<div id="cell-86" class="cell" data-execution_count="283">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct4.fit_transform(train_sub))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-87" class="cell" data-execution_count="284">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'SVM'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="284">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.629788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.027410</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.584310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.985634</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.415690</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.549876</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.014366</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-5-1" class="level3">
<h3 class="anchored" data-anchor-id="sub-5-1">Sub 5</h3>
<div id="cell-89" class="cell" data-execution_count="285">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-90" class="cell" data-execution_count="286">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'SVM'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="286">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.630456</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.021362</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.723437</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.988761</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.276562</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.547511</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.011239</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="lda" class="level2">
<h2 class="anchored" data-anchor-id="lda">LDA</h2>
<section id="sub-1-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-1-2">Sub 1</h3>
<div id="cell-93" class="cell" data-execution_count="287">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct1.fit_transform(train_sub))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-94" class="cell" data-execution_count="288">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="288">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.639540</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.425089</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.484637</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.638066</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.515363</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.632198</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.361934</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-2-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-2-2">Sub 2</h3>
<div id="cell-96" class="cell" data-execution_count="289">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct2.fit_transform(train_sub))</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-97" class="cell" data-execution_count="290">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="290">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.646788</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.458219</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.469278</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.595903</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.530722</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.648854</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.404097</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-3-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-3-2">Sub 3</h3>
<div id="cell-99" class="cell" data-execution_count="291">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct3.fit_transform(train_sub))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-100" class="cell" data-execution_count="292">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="292">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.628821</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.408467</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.504374</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.652270</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.495626</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.619167</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.347730</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-4-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-4-2">Sub 4</h3>
<div id="cell-102" class="cell" data-execution_count="293">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct4.fit_transform(train_sub))</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-103" class="cell" data-execution_count="294">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="294">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.582643</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.338686</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.399030</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.595798</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.600970</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.614872</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.404202</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="sub-5-2" class="level3">
<h3 class="anchored" data-anchor-id="sub-5-2">Sub 5</h3>
<div id="cell-105" class="cell" data-execution_count="295">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub))</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-106" class="cell" data-execution_count="296">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="296">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.642047</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.445041</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.482078</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.609377</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.517922</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.643419</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.390623</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="final-model" class="level1">
<h1>Final Model</h1>
<section id="classification-model-linear-discriminant-analysis" class="level3">
<h3 class="anchored" data-anchor-id="classification-model-linear-discriminant-analysis">Classification Model: Linear Discriminant Analysis</h3>
</section>
<section id="variable-set-set-5" class="level3">
<h3 class="anchored" data-anchor-id="variable-set-set-5">Variable Set: Set 5</h3>
<p>Variables:</p>
<p>FLAG_OWN_CAR, DAYS_BIRTH, REFUSED, N_ONTIME_PAY, N_PAYMENTS, DEF_30_CNT_SOCIAL_CIRCLE, NAME_EDUCATION_TYPE, NAME_INCOME_TYPE, REGION_RATING_CLIENT_W_CITY</p>
<p>Here we are running the final model on a larger set of data with a more representative proportion of observations with TARGET==1 to guage performance</p>
</section>
<section id="increased-subsample-size" class="level2">
<h2 class="anchored" data-anchor-id="increased-subsample-size">Increased Subsample Size</h2>
<div id="cell-111" class="cell" data-execution_count="297">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>train_sub2_pos <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">20000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>train_sub2_neg <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">0</span>].sample(<span class="dv">180000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>train_sub2 <span class="op">=</span> pd.concat([train_sub_pos, train_sub_neg], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub2))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub2[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-112" class="cell" data-execution_count="298">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'k-fold'</span>, cutoff<span class="op">=</span><span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="298">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.799200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.019238</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.573214</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.990120</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.426786</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.643805</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.009880</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-113" class="cell" data-execution_count="299">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="299">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.634317</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.021445</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.405398</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.989067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Precision</td>
<td>0.594602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>ROC-AUC</td>
<td>0.643184</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>Recall</td>
<td>0.010933</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="threshold-tuning" class="level2">
<h2 class="anchored" data-anchor-id="threshold-tuning">Threshold Tuning</h2>
<div id="cell-115" class="cell" data-execution_count="300">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">35</span>, <span class="dv">5</span>):</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Cutoff: </span><span class="sc">{</span>i<span class="op">/</span><span class="dv">100</span><span class="sc">}</span><span class="ss">:'</span>)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span>i<span class="op">/</span><span class="dv">100</span>))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cutoff: 0.05:
                 metric       val
0              Accuracy  0.372055
1                    F1  0.540213
2  False Discovery Rate  0.629814
3   False Negative Rate  0.000851
4             Precision  0.370186
5               ROC-AUC  0.642477
6                Recall  0.999149

Cutoff: 0.1:
                 metric       val
0              Accuracy  0.419559
1                    F1  0.548637
2  False Discovery Rate  0.615939
3   False Negative Rate  0.039671
4             Precision  0.384061
5               ROC-AUC  0.643473
6                Recall  0.960329

Cutoff: 0.15:
                 metric       val
0              Accuracy  0.523855
1                    F1  0.557890
2  False Discovery Rate  0.575119
3   False Negative Rate  0.187046
4             Precision  0.424881
5               ROC-AUC  0.641439
6                Recall  0.812954

Cutoff: 0.2:
                 metric       val
0              Accuracy  0.609387
1                    F1  0.537267
2  False Discovery Rate  0.522120
3   False Negative Rate  0.385715
4             Precision  0.477880
5               ROC-AUC  0.648132
6                Recall  0.614285

Cutoff: 0.25:
                 metric       val
0              Accuracy  0.644871
1                    F1  0.449691
2  False Discovery Rate  0.473761
3   False Negative Rate  0.607256
4             Precision  0.526239
5               ROC-AUC  0.644857
6                Recall  0.392744

Cutoff: 0.3:
                 metric       val
0              Accuracy  0.642072
1                    F1  0.296335
2  False Discovery Rate  0.454260
3   False Negative Rate  0.796388
4             Precision  0.545740
5               ROC-AUC  0.644214
6                Recall  0.203612

Cutoff: 0.35:
                 metric       val
0              Accuracy  0.641237
1                    F1  0.175046
2  False Discovery Rate  0.419961
3   False Negative Rate  0.896622
4             Precision  0.580039
5               ROC-AUC  0.641677
6                Recall  0.103378

Cutoff: 0.4:
                 metric       val
0              Accuracy  0.641541
1                    F1  0.104799
2  False Discovery Rate  0.370946
3   False Negative Rate  0.942778
4             Precision  0.629054
5               ROC-AUC  0.641220
6                Recall  0.057222
</code></pre>
</div>
</div>
<p>Cutoff at 0.2 does well at balancing many of the different metrics. It has one of the largest F1-scores meaning it balances precision and recall very well. Additionally, it has one the larger values for accuracy, and keeps the false dicovery and false negative rate lower.</p>
</section>
</section>
<section id="comparing-logreg-svm-and-lda" class="level1">
<h1>Comparing LogReg, SVM, and LDA</h1>
<p>In this section we compare the prediction results for LogReg, SVM, and LDA using the same variable set, data, and cutoff threshold.</p>
<div id="cell-119" class="cell" data-execution_count="451">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>train_sub_pos <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">2000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>train_sub_neg <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">0</span>].sample(<span class="dv">8000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>train_sub <span class="op">=</span> pd.concat([train_sub_pos, train_sub_neg], axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-120" class="cell" data-execution_count="452">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>ct5 <span class="op">=</span> make_column_transformer(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>]),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'REFUSED'</span>, <span class="st">'N_ONTIME_PAY'</span>, <span class="st">'N_PAYMENTS'</span>, <span class="st">'DEF_30_CNT_SOCIAL_CIRCLE'</span>]),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>]),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub))</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-121" class="cell" data-execution_count="470">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>splits <span class="op">=</span> []</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>indicies <span class="op">=</span> random.sample(<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(X))), <span class="bu">len</span>(X))</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> i <span class="op">&lt;</span> numSplits:</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    testIndicies <span class="op">=</span> <span class="bu">set</span>(indicies[<span class="bu">int</span>((i<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(X)) : <span class="bu">int</span>((((i<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span>numSplits)<span class="op">*</span><span class="bu">len</span>(X)))])</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>    trainIndicies <span class="op">=</span> <span class="bu">set</span>(indicies) <span class="op">-</span> testIndicies</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>    splits.append((trainIndicies, testIndicies))</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> i<span class="op">+</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we are fitting 3 models with the same variable sets and threshold to compare the predictions/predicted probabilities of each classification method.</p>
<div id="cell-123" class="cell" data-execution_count="476">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> train, test <span class="kw">in</span> splits:</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>        train_x <span class="op">=</span> X.iloc[<span class="bu">list</span>(train)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>        train_y <span class="op">=</span> Y.iloc[<span class="bu">list</span>(train)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>        test_x <span class="op">=</span> X.iloc[<span class="bu">list</span>(test)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>        test_y <span class="op">=</span> Y.iloc[<span class="bu">list</span>(test)].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>        betas1 <span class="op">=</span> fit_logreg(train_x, train_y, <span class="fl">.0002</span>, <span class="dv">0</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>        z <span class="op">=</span> test_x.to_numpy() <span class="op">@</span> betas1</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>        p1 <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (<span class="dv">1</span> <span class="op">+</span> np.exp((<span class="op">-</span><span class="dv">1</span>)<span class="op">*</span>z))</span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>        preds1 <span class="op">=</span> (p1 <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>        model_svc <span class="op">=</span> SVC(probability<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a>        model_svc.fit(train_x, train_y)</span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a>        p2 <span class="op">=</span> model_svc.predict_proba(test_x)[:,<span class="dv">1</span>]</span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a>        preds2 <span class="op">=</span> (p2 <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>        model_lda <span class="op">=</span> LinearDiscriminantAnalysis()</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>        model_lda.fit(train_x, train_y)</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>        p3 <span class="op">=</span> model_lda.predict_proba(test_x)[:,<span class="dv">1</span>]</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>        preds3 <span class="op">=</span> (p3 <span class="op">&gt;</span> cutoff).astype(<span class="bu">int</span>)</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="probabilities-scores" class="level3">
<h3 class="anchored" data-anchor-id="probabilities-scores">Probabilities / Scores</h3>
<div id="cell-125" class="cell" data-execution_count="491">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>plt.hist(p1)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Logistic Regression'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="loans_code_files/figure-html/cell-74-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-126" class="cell" data-execution_count="492">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>plt.hist(p2)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Support Vector Classification'</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="loans_code_files/figure-html/cell-75-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-127" class="cell" data-execution_count="493">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>plt.hist(p3)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Linear Discriminant Analysis'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="dv">0</span>, <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="loans_code_files/figure-html/cell-76-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The histograms show the distribution of predicted scores/probabilities for each observation in the testing set for each of the three methods. We see LDA, and LogReg are the most similar with somewhat skewed right distributions. A majority of the predicted scores/proababilities are around 0.2 which was the choosen cutoff. LDA similarly has a majoirty of predictions around 0.2 however the scores/probas spread little from there.</p>
<div id="cell-129" class="cell" data-execution_count="495">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>p1.mean(), p2.mean(), p3.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="495">
<pre><code>(0.20393665273146144, 0.2028579613452813, 0.20054437706379932)</code></pre>
</div>
</div>
<div id="cell-130" class="cell" data-execution_count="496">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>p1.std(), p2.std(), p3.std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="496">
<pre><code>(0.07350896370241009, 0.01587892007277395, 0.07960131766803259)</code></pre>
</div>
</div>
<p>Looking at the means, we see each model produced probabilites/scores centered around 0.2 which confirms what is seen in the plots. Additionally, we see the scores from SVC have little spread compared to LogReg and LDA.</p>
<p>From this we see that SVC is struggling to separate the two groups (TARGET==0/1). One potential reason for this would be due to the imbalanced groups. It may be struggling to create separation between the groups because the TARGET==1 group is not dense enough to determine the best way to create group separation.</p>
</section>
<section id="predictions" class="level3">
<h3 class="anchored" data-anchor-id="predictions">Predictions</h3>
<div id="cell-134" class="cell" data-execution_count="512">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df_preds <span class="op">=</span> pd.DataFrame({<span class="st">'LogReg'</span>:pd.Series(preds1), <span class="st">'SVC'</span>:pd.Series(preds2), <span class="st">'LDA'</span>:pd.Series(preds3)})</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df_preds.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="512">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LogReg</th>
<th data-quarto-table-cell-role="th">SVC</th>
<th data-quarto-table-cell-role="th">LDA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-135" class="cell" data-execution_count="516">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_preds.groupby([<span class="st">'LogReg'</span>, <span class="st">'SVC'</span>, <span class="st">'LDA'</span>]).value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="516">
<pre><code>LogReg  SVC  LDA
0       0    0      2627
             1        81
        1    0        96
             1        14
1       0    0       173
             1      1660
        1    0        12
             1       337
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>From the table we can see that SVC, LDA, and LogReg all tended to predict similar observations as 0. There were 2627 times where all three agreed on an observation prediction being 0. SVC on the other hand tended to still predict 0 when LogReg and LDA predicted 1. This happend 1660 times which is a significant difference.</p>
</section>
<section id="algorithm-comparison-conclusions" class="level2">
<h2 class="anchored" data-anchor-id="algorithm-comparison-conclusions">Algorithm Comparison Conclusions</h2>
<p>Overall, LogReg and LDA performed very similarly on this data. From the histograms we saw how the distributions of scores/probabilities were very similar for these two methods. Additionally, these models tended to produce similar predictions as seen in the table above.</p>
<p>SVC differed heavily from LogReg and LDA. SVC struggled to produce different/spread out scores and probabilities for the testing data. This is seen in the histogram of its scores/probabilities above. This led to SVC predicting TARGET == 0 for a vast majority of observations and disagreeing with LDA and LogReg when these models predicted TARGET == 1</p>
</section>
</section>
<section id="fairness" class="level1">
<h1>Fairness</h1>
<p>In this section we will be exploring the fairness of different models by using females as the protected group.</p>
<p>Fairness can be incorporated into the cross validation code by including prot_group_data which is the column representing the protected group. The column should have values of 1 for obs in the protected group and 0 otherwise</p>
<section id="fairness-metric-equalized-odds" class="level2">
<h2 class="anchored" data-anchor-id="fairness-metric-equalized-odds">Fairness Metric = Equalized Odds</h2>
<p>Equalized odds says that a fair classifier should make predictions about a protected group with the same true positive rate and false positive rate as the other group. Therefore equalized odds consists of two metrics, the true pos rate and false positive rate which compare the predictions for the protected group to the other group.</p>
<p>A fair model should have both the True Pos Rate and False Pos Rate values above 0.80. A fair model across the groups would desire values close to 1.</p>
</section>
<section id="testing-fairness-of-different-models" class="level2">
<h2 class="anchored" data-anchor-id="testing-fairness-of-different-models">Testing Fairness of Different Models</h2>
<div id="cell-145" class="cell" data-execution_count="302">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>train_sub2_pos <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">1</span>].sample(<span class="dv">2000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>train_sub2_neg <span class="op">=</span> train_full[train_full[<span class="st">'TARGET'</span>] <span class="op">==</span> <span class="dv">0</span>].sample(<span class="dv">8000</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>train_sub2 <span class="op">=</span> pd.concat([train_sub_pos, train_sub_neg], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>prot_group <span class="op">=</span> (train_sub2[<span class="st">'CODE_GENDER'</span>] <span class="op">==</span> <span class="st">'F'</span>).astype(<span class="bu">int</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="best-predictive-model-w-gender-included" class="level4">
<h4 class="anchored" data-anchor-id="best-predictive-model-w-gender-included">Best Predictive Model w/ Gender Included</h4>
<div id="cell-147" class="cell" data-execution_count="303">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>ct6 <span class="op">=</span> make_column_transformer(</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    (OrdinalEncoder(), [<span class="st">'FLAG_OWN_CAR'</span>]),</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    (StandardScaler(), [<span class="st">'DAYS_BIRTH'</span>, <span class="st">'REFUSED'</span>, <span class="st">'N_ONTIME_PAY'</span>, <span class="st">'N_PAYMENTS'</span>, <span class="st">'DEF_30_CNT_SOCIAL_CIRCLE'</span>]),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(), [<span class="st">"NAME_EDUCATION_TYPE"</span>, <span class="st">'NAME_INCOME_TYPE'</span>, <span class="st">'REGION_RATING_CLIENT_W_CITY'</span>, <span class="st">'CODE_GENDER'</span>]),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"drop"</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct6.fit_transform(train_sub2))</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub2[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-148" class="cell" data-execution_count="304">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.2</span>, prot_group_data<span class="op">=</span>prot_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="304">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.614305</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.542041</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.519903</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.376203</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False Pos Rate</td>
<td>1.059275</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Precision</td>
<td>0.480097</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>ROC-AUC</td>
<td>0.650752</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Recall</td>
<td>0.623797</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>True Pos Rate</td>
<td>1.059431</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The results above are interesting. We see the False Pos Rate and True Pos Rate are still both close to 1. This means including gender does not compromise the fairness of the best predictive model.</p>
</section>
<section id="logreg-models" class="level3">
<h3 class="anchored" data-anchor-id="logreg-models">LogReg Models</h3>
<div id="cell-151" class="cell" data-execution_count="307">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub2))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub2[<span class="st">'TARGET'</span>]</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.2</span>, prot_group_data<span class="op">=</span>prot_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="307">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.593781</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.532630</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.537877</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.370711</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False Pos Rate</td>
<td>0.899140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Precision</td>
<td>0.462123</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>ROC-AUC</td>
<td>0.638376</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Recall</td>
<td>0.629289</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>True Pos Rate</td>
<td>0.992429</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The logistic regression model using variable set 5 which was our optimal set produces another fiar model. We see both the False Pos rate and True pos rate are above 0.80.</p>
<div id="cell-153" class="cell" data-execution_count="305">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct6.fit_transform(train_sub2))</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub2[<span class="st">'TARGET'</span>]</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'logReg'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.2</span>, prot_group_data<span class="op">=</span>prot_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="305">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.606369</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.540987</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.524680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.371471</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False Pos Rate</td>
<td>1.000128</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Precision</td>
<td>0.475320</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>ROC-AUC</td>
<td>0.646699</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Recall</td>
<td>0.628529</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>True Pos Rate</td>
<td>0.987097</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The model using Logistic Regression with the same variable set including gender is extremely fair according to equalized odds across gender.</p>
</section>
</section>
<section id="fairness-for-our-best-predictive-model" class="level2">
<h2 class="anchored" data-anchor-id="fairness-for-our-best-predictive-model">Fairness for our best predictive Model</h2>
<div id="cell-156" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.DataFrame(ct5.fit_transform(train_sub2))</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> train_sub2[<span class="st">'TARGET'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-157" class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span><span class="fl">.2</span>, prot_group_data<span class="op">=</span>prot_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">metric</th>
<th data-quarto-table-cell-role="th">val</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Accuracy</td>
<td>0.601005</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>F1</td>
<td>0.526430</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>False Discovery Rate</td>
<td>0.532138</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>False Negative Rate</td>
<td>0.397757</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>False Pos Rate</td>
<td>0.950426</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>Precision</td>
<td>0.467862</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>ROC-AUC</td>
<td>0.634791</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>Recall</td>
<td>0.602243</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>True Pos Rate</td>
<td>1.005951</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looking at the False Pos Rate and the True Pos Rate, our best predictive model is very fair. The True Pos Rate and False Pos Rate are both very close to 1 indicating the model predictions are very similar for males and females.</p>
<section id="fairness-vs-threshold" class="level3">
<h3 class="anchored" data-anchor-id="fairness-vs-threshold">Fairness vs Threshold</h3>
<div id="cell-160" class="cell" data-execution_count="306">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>, <span class="dv">35</span>, <span class="dv">5</span>):</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Cutoff: </span><span class="sc">{</span>i<span class="op">/</span><span class="dv">100</span><span class="sc">}</span><span class="ss">:'</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(crossVal(<span class="st">'LDA'</span>, X, Y, <span class="fl">.0002</span>, <span class="dv">4</span>, <span class="st">'stratified_target'</span>, cutoff<span class="op">=</span>i<span class="op">/</span><span class="dv">100</span>, prot_group_data<span class="op">=</span>prot_group))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cutoff: 0.05:
                 metric       val
0              Accuracy  0.371762
1                    F1  0.538658
2  False Discovery Rate  0.631287
3   False Negative Rate  0.000570
4        False Pos Rate  0.999294
5             Precision  0.368713
6               ROC-AUC  0.651276
7                Recall  0.999430
8         True Pos Rate  1.000287

Cutoff: 0.1:
                 metric       val
0              Accuracy  0.427138
1                    F1  0.550701
2  False Discovery Rate  0.613252
3   False Negative Rate  0.043894
4        False Pos Rate  1.004713
5             Precision  0.386748
6               ROC-AUC  0.652100
7                Recall  0.956106
8         True Pos Rate  0.994966

Cutoff: 0.15:
                 metric       val
0              Accuracy  0.542336
1                    F1  0.566825
2  False Discovery Rate  0.563112
3   False Negative Rate  0.192238
4        False Pos Rate  0.993376
5             Precision  0.436888
6               ROC-AUC  0.649567
7                Recall  0.807762
8         True Pos Rate  1.011801

Cutoff: 0.2:
                 metric       val
0              Accuracy  0.608619
1                    F1  0.536680
2  False Discovery Rate  0.526661
3   False Negative Rate  0.380061
4        False Pos Rate  1.010576
5             Precision  0.473339
6               ROC-AUC  0.652657
7                Recall  0.619939
8         True Pos Rate  0.978003

Cutoff: 0.25:
                 metric       val
0              Accuracy  0.647128
1                    F1  0.454263
2  False Discovery Rate  0.471020
3   False Negative Rate  0.601275
4        False Pos Rate  0.918154
5             Precision  0.528980
6               ROC-AUC  0.651767
7                Recall  0.398725
8         True Pos Rate  1.011293

Cutoff: 0.3:
                 metric       val
0              Accuracy  0.644753
1                    F1  0.317746
2  False Discovery Rate  0.455527
3   False Negative Rate  0.775236
4        False Pos Rate  0.980993
5             Precision  0.544473
6               ROC-AUC  0.650409
7                Recall  0.224764
8         True Pos Rate  1.020681
</code></pre>
</div>
</div>
<p>From the results above, we see the fairness of the model is fairly constant across different thresholds. We see that the false pos rate and true pos rate are consistently above 0.8 and close to 1.</p>
</section>
</section>
<section id="final-fairness-analysis" class="level2">
<h2 class="anchored" data-anchor-id="final-fairness-analysis">Final Fairness Analysis</h2>
<p>Because our best predictive model was also extremely fair when examining females as a protected group when looking at equalized odds, there were no sacrifices needing to be made with respect to the predictive performance of the model. Additoinal models that were tested to examine fairness also produced very good results with respect to fairness however none of these models were able to be significantly more fair than our best predictive model and top its prediction performance.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>